<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>v1 tool</title>
<style>
main {
	padding: 2em;
	margin:auto;
	text-align: center;
	font-size: smaller;
}
textarea, .button {
	padding: 1em;
	margin: 1em;
	background-color: #eee;
	text-decoration: none;
	display: inline-block;
	border-radius: 1em;
}
textarea {
	width: 100%;
	margin:0;
}
</style>
</head>
<body>
<main>
	<p><b>Instructions:</b> Open the Developer Tools (F12 in Windows / cmd + alt + J in Mac) -> Network tab. In game, navigate to the relevant page. Find /v1/xxx in the console -> right click the item -> "Copy" -> "Copy response" -> paste to relevant textbox</p>
	<textarea id="in">
		
	</textarea><br />
	<div class="button" id="stage">stage/#</div>
	<div class="button" id="battle">battle</div>
	<div class="button" id="myroom">myroom</div>
	<div class="button" id="generate">generate page copy</div>
	<a class="button" id="download" href="" download="v1-saved.html">save page</a>
</main>
<div id="out"></div>
<script>
	function link(url) {
		return("<a href=\"" + url + "\">" + url + "</a>");
	}
	function llink(url, text) {
		return("<a href=\"" + url + "\">" + text + "</a>");
	}
	function br(text) {
		return("\n<br>" + text);
	}
	function b(text) {
		return("\n\n<br><br><b>" + text + "</b>");
	}
	function p(text) {
		return ("\n<b style=\"font-size: larger;\">" + text + "</b>");
	}

	document.getElementById("generate").addEventListener("click", function() {
		var txt = '<!DOCTYPE html><html><body><meta http-equiv="content-type" content="text/html; charset=utf-8">' + document.getElementById("out").innerHTML + '</body></html>';
		document.getElementById("download").href = 'data:text/html;charset=utf-8,' + encodeURIComponent(txt);
		document.getElementById("download").setAttribute("style","background-color: #ccc;");
	});
	document.getElementById("download").addEventListener("click", function() {
		this.setAttribute("style","background-color: #eee;");
	});

	out = document.getElementById("out");
	var o = "";
	
	document.getElementById("stage").addEventListener("click", function() {
		json = JSON.parse(document.getElementById("in").value);
		o += b("Tainted Book: " + json.stage.name);
		
		if(json.adv != null) {
			o += b("Voice Paths: ");
			for(var item of json.adv[0].voice_paths) {
				o += br(link(item));
			}
			o += b("Skit: ");
			for(var item of json.adv[0].contents) {
				if(item.serif != "") {
					o += br(item.talker_num + " " + item.talker_name + " : ");
					o += br(item.serif.replace(/\s/g,"").replace(/n/g,"").replace(/\\/g,"<br />"));
				}
			}
		}

		for(var unit of json.deck.units) {
			o += "<hr>\n" + p(unit.mst_unit_id + " " + unit.master.name);
			o += b("Image: ");
			for(var item of unit.images) {
				o += br(link(item.path));
			}
			o += b("Voice: ");
			for(var item of unit.voices) {
				o += br(llink(item.path, item.name));
			}
		}

		out.innerHTML = o;

	});

	document.getElementById("battle").addEventListener("click", function() {
		json = JSON.parse(document.getElementById("in").value);
	
		if(json.adv != null) {
			o += b("Voice Paths: ");
			for(var item of json.adv[0].voice_paths) {
				o += br(link(item));
			}
			o += b("Skit: ");
			for(var item of json.adv[0].contents) {
				if(item.serif != "") {
					o += br(item.talker_num + " " + item.talker_name + " : ");
					o += br(item.serif.replace(/\s/g,"").replace(/n/g,"").replace(/\\/g,"<br />"));
				}
			}
		}

		o += b("Enemies: ");
		for(var i in json.result.enemies) {
			item = json.result.enemies[i];
			o += br(llink(item.img_path,item.name) + ", exp: " + item.exp + ", id: ", + item.id);
		}

		out.innerHTML = o;

	});

	document.getElementById("myroom").addEventListener("click", function() {
		json = JSON.parse(document.getElementById("in").value);
	
	
		o += br("Leader: " + json.header.leader_unit.mst_unit_id + " " + json.header.leader_unit.master.name);
		for(var item of json.header.leader_unit.voices) {
			o += br(llink(item.path, item.name));
		}

		for(var unit of json.units) {
			o += b(unit.mst_unit_id + " " + unit.master.name);
			o += br(llink(unit.images[0].path,"normal"));
			o += br(llink(unit.images[1].path,"weakened weaponless"));
			o += br(llink(unit.icons[0].path, unit.icons[0].name));
		}

		out.innerHTML = o;

	});
</script>
</body>
</html>